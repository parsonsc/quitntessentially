!function(t,r){"function"==typeof define&&define.amd?define(r):"object"==typeof exports?module.exports=r():t.Sifter=r()}(this,function(){var t=function(t,r){this.items=t,this.settings=r||{diacritics:!0}};t.prototype.tokenize=function(t){if(t=n(String(t||"").toLowerCase()),!t||!t.length)return[];var r,e,o,u,f=[],c=t.split(/ +/);for(r=0,e=c.length;e>r;r++){if(o=i(c[r]),this.settings.diacritics)for(u in s)s.hasOwnProperty(u)&&(o=o.replace(new RegExp(u,"g"),s[u]));f.push({string:c[r],regex:new RegExp(o,"i")})}return f},t.prototype.iterator=function(t,r){var e;e=o(t)?Array.prototype.forEach||function(t){for(var r=0,e=this.length;e>r;r++)t(this[r],r,this)}:function(t){for(var r in this)this.hasOwnProperty(r)&&t(this[r],r,this)},e.apply(t,[r])},t.prototype.getScoreFunction=function(t,r){var e,n,i,o;e=this,t=e.prepareSearch(t,r),i=t.tokens,n=t.options.fields,o=i.length;var s=function(t,r){var e,n;return t?(t=String(t||""),n=t.search(r.regex),-1===n?0:(e=r.string.length/t.length,0===n&&(e+=.5),e)):0},u=function(){var t=n.length;return t?1===t?function(t,r){return s(r[n[0]],t)}:function(r,e){for(var i=0,o=0;t>i;i++)o+=s(e[n[i]],r);return o/t}:function(){return 0}}();return o?1===o?function(t){return u(i[0],t)}:"and"===t.options.conjunction?function(t){for(var r,e=0,n=0;o>e;e++){if(r=u(i[e],t),0>=r)return 0;n+=r}return n/o}:function(t){for(var r=0,e=0;o>r;r++)e+=u(i[r],t);return e/o}:function(){return 0}},t.prototype.getSortFunction=function(t,e){var n,i,o,s,u,f,c,a,p,h,l;if(o=this,t=o.prepareSearch(t,e),l=!t.query&&e.sort_empty||e.sort,p=function(t,r){return"$score"===t?r.score:o.items[r.id][t]},u=[],l)for(n=0,i=l.length;i>n;n++)(t.query||"$score"!==l[n].field)&&u.push(l[n]);if(t.query){for(h=!0,n=0,i=u.length;i>n;n++)if("$score"===u[n].field){h=!1;break}h&&u.unshift({field:"$score",direction:"desc"})}else for(n=0,i=u.length;i>n;n++)if("$score"===u[n].field){u.splice(n,1);break}for(a=[],n=0,i=u.length;i>n;n++)a.push("desc"===u[n].direction?-1:1);return f=u.length,f?1===f?(s=u[0].field,c=a[0],function(t,e){return c*r(p(s,t),p(s,e))}):function(t,e){var n,i,o;for(n=0;f>n;n++)if(o=u[n].field,i=a[n]*r(p(o,t),p(o,e)))return i;return 0}:null},t.prototype.prepareSearch=function(t,r){if("object"==typeof t)return t;r=e({},r);var n=r.fields,i=r.sort,s=r.sort_empty;return n&&!o(n)&&(r.fields=[n]),i&&!o(i)&&(r.sort=[i]),s&&!o(s)&&(r.sort_empty=[s]),{options:r,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,r){var e,n,i,o,s=this;return n=this.prepareSearch(t,r),r=n.options,t=n.query,o=r.score||s.getScoreFunction(n),t.length?s.iterator(s.items,function(t,i){e=o(t),(r.filter===!1||e>0)&&n.items.push({score:e,id:i})}):s.iterator(s.items,function(t,r){n.items.push({score:1,id:r})}),i=s.getSortFunction(n,r),i&&n.items.sort(i),n.total=n.items.length,"number"==typeof r.limit&&(n.items=n.items.slice(0,r.limit)),n};var r=function(t,r){return"number"==typeof t&&"number"==typeof r?t>r?1:r>t?-1:0:(t=String(t||"").toLowerCase(),r=String(r||"").toLowerCase(),t>r?1:r>t?-1:0)},e=function(t){var r,e,n,i;for(r=1,e=arguments.length;e>r;r++)if(i=arguments[r])for(n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t},n=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},i=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},o=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s={a:"[aÀÁÂÃÄÅàáâãäåĀā]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒē]",i:"[iÌÍÎÏìíîïĪī]",n:"[nÑñňŇ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠš]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽž]"};return t});